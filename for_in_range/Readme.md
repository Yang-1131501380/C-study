## C++ 基于范围的 for 循环总结

### 什么是基于范围的 for 循环

基于范围的 for 循环（range-based for loop）是 C++11 引入的新特性，提供了一种简洁、安全的方式遍历容器或其他可迭代对象中的所有元素。它抽象了传统 for 循环的迭代器操作，使代码更易读、更不易出错。

### 基本语法

```cpp
// 只读访问（推荐使用const引用）
for (const auto& element : container) {
    // 使用element
}

// 修改元素（使用引用）
for (auto& element : container) {
    // 修改element
}

// 直接使用值（会产生副本，不推荐用于大型对象）
for (auto element : container) {
    // 使用element的副本
}
```

### 适用范围

1. **标准容器**：`vector`、`array`、`list`、`map`、`set`、`string`等
2. **C 风格数组**：如`int arr[] = {1, 2, 3}`
3. **自定义容器**：实现了`begin()`和`end()`方法的类
4. **初始化列表**：如`{1, 2, 3, 4}`

## 使用注意事项

1. **元素访问方式**：
   - 只读访问时，使用`const auto&`可以避免不必要的复制，提高效率
   - 需要修改元素时，使用`auto&`（非常量引用）
   - 直接使用`auto`会创建元素副本，修改副本不会影响原容器
2. **迭代顺序**：
   - 总是按照元素在容器中的存储顺序遍历
   - 对于无序容器（如`unordered_map`），遍历顺序不确定
3. **容器修改限制**：
   - 遍历过程中**不要修改容器的结构**（添加、删除元素），这会导致迭代器失效，产生未定义行为
   - 如果需要修改容器结构，应使用传统 for 循环和迭代器
4. **循环变量作用域**：
   - 循环变量（element）只在循环体内有效，避免了变量名污染
5. **与传统 for 循环的选择**：
   - 当需要遍历整个容器且不需要索引时，优先使用基于范围的 for 循环
   - 当需要索引、部分遍历或修改容器结构时，使用传统 for 循环
6. **特殊情况处理**：
   - 遍历空容器是安全的，循环体不会执行
   - 对于需要忽略元素值的场景，可使用`[[maybe_unused]]`属性消除编译器警告
7. **兼容性**：
   - 要求编译器支持 C++11 或更高标准
   - 自定义容器需要提供`begin()`和`end()`方法（可以是成员函数或非成员函数）

基于范围的 for 循环是现代 C++ 中推荐的遍历方式，它简化了代码并减少了出错的可能性。合理使用可以使代码更加简洁、清晰和高效。